# 要件定義書：AI採用候補者評価アプリ（テキスト入力・設定外部化版） Ver.1.2

## 1. 概要

### 1.1. 背景・目的 (変更なし)
### 1.2. システム概要 (更新)
本システムはWebアプリケーションとして提供される。利用者はWebブラウザを通じて、候補者情報をテキストボックスに貼り付け「解析」ボタンを押す。バックエンドAPIは受け取ったテキストを**定義済みルールに基づきクレンジング**後、Google Gemini APIと連携して**外部設定ファイル(`config.py`)で定義された評価基準（プロンプト）**に基づき候補者を評価する。評価結果（AI評価）と、**外部設定ファイル(`config.py`)の重み付けルール**に基づいて計算されたマッチ度スコアはフロントエンドに返却される。フロントエンドは**解析結果をリストとして累積保持**し、最新の結果詳細と過去の結果リストをダッシュボードに表示する。利用者は表示・保持している評価結果リストをCSVまたはMarkdown形式でエクスポートできる。DBは使用しない。
### 1.3. スコープ (更新)
*   **対象範囲（IN SCOPE）**
    *   候補者情報テキスト入力・貼り付け機能
    *   **入力テキストのルールベースでのクレンジング機能** (`utils/text_processing.py`)
    *   Google Gemini API連携による候補者評価（**評価基準は `config.py` で定義**）
    *   マッチ度スコア計算機能（**評価記号・重み付けは `config.py` で定義**）
    *   評価結果（AI評価 + 計算スコア）の構造化データ生成
    *   **フロントエンドでの評価結果リストの累積保持機能**
    *   Webダッシュボードへの**最新結果詳細表示と履歴リスト表示機能**
    *   保持している評価結果リストのCSV形式でのエクスポート機能
    *   保持している評価結果リストのMarkdown形式でのエクスポート機能
    *   **評価基準・スコア設定の外部ファイル化** (`config.py`)
    *   基本的なエラーハンドリング
*   **対象範囲外（OUT OF SCOPE）**
    *   ユーザーアカウント管理、ログイン認証機能
    *   候補者情報および評価結果の**永続的なデータベース保存機能**
    *   評価基準（プロンプト、重み付け）の**UIからの動的な編集・管理機能**
    *   過去の評価履歴の**永続的な参照機能**（ブラウザリロードで消える）
    *   ファイルからの直接インポート機能
    *   高度な分析機能
    *   外部ATS連携
### 1.4. 用語定義 (更新)
| 用語                 | 定義                                                                                                                               |
| :------------------- | :--------------------------------------------------------------------------------------------------------------------------------- |
| ...                  | ...                                                                                                                                |
| 評価基準（プロンプト） | **`config.py` に定義**された採用条件マッチ度計算プロンプト。                                                                           |
| スコアリング設定     | **`config.py` に定義**された評価記号とスコアのマッピング、カテゴリ別重み、項目別重み。                                                     |
| クレンジングルール   | **`utils/text_processing.py` に定義**された、入力テキストから不要情報を除去するためのルール（正規表現など）。                                  |
| 結果リスト           | **フロントエンドのメモリに保持**される、複数の評価結果（AI評価+計算スコア）オブジェクトの配列。ブラウザを閉じると消える。                      |
| ...                  | ...                                                                                                                                |
### 1.5. 参考文献 (更新)
*   Candidate Evaluator API定義書 Ver.1.2 (OpenAPI YAML)
*   ユーザー提供の評価基準 (現在は `config.py` に反映)

## 2. システム要件

### 2.1. 機能要件 (更新)
| ID    | 要件名                     | 詳細                                                                                                                               | 優先度 |
| :---- | :------------------------- | :--------------------------------------------------------------------------------------------------------------------------------- | :----- |
| FR-01 | 候補者情報テキスト入力   | (変更なし)                                                                                                                           | 高     |
| FR-02 | 解析実行トリガー       | (変更なし)                                                                                                                           | 高     |
| FR-03 | **テキストクレンジング** | バックエンドは受け取ったテキストに対し、**`utils/text_processing.py` のルール**に基づき不要情報を除去する。                                | 高     |
| FR-04 | Gemini API連携           | バックエンドは**クレンジング後のテキスト**と**`config.py` の評価基準プロンプト**を整形し、Gemini APIに評価リクエストを送信する。             | 高     |
| FR-05 | AI評価結果取得・解析     | (変更なし) バックエンドはGemini APIからのJSON形式の評価結果を取得・解析する。                                                           | 高     |
| FR-06 | マッチ度スコア計算       | バックエンドはGeminiの評価記号と**`config.py` のスコアリング設定**に基づき、総合スコアとカテゴリ別スコアを計算する (`scoring_service.py`)。 | 高     |
| FR-07 | 評価結果生成             | バックエンドは、**AI評価結果と計算スコアをまとめた**JSONオブジェクトをフロントエンドに返す。                                                 | 高     |
| FR-08 | **結果リスト累積・表示** | フロントエンドはAPI応答を受け取り、**結果をリスト(`resultsList` state)に累積**。**最新結果の詳細と過去の結果リスト（概要）**をダッシュボードに表示。 | 高     |
| FR-10 | 評価結果一時保持         | (変更なし) フロントエンドは結果リストデータをブラウザメモリに一時保持。                                                                 | 高     |
| FR-11 | エクスポート形式選択     | (変更なし)                                                                                                                           | 高     |
| FR-12 | **結果リストエクスポート** | 利用者がエクスポートを実行すると、フロントエンドは**保持している結果リスト全体**と形式をバックエンドの `/export` API に送信。バックエンドはCSV/MDファイルを生成しダウンロードさせる。 | 高     |
| FR-13 | Gemini APIキー設定       | (変更なし) バックエンドの `.env` で管理。                                                                                           | 高     |
| FR-14 | エラーハンドリング         | (変更なし) ファイル解析エラーはテキストクレンジングエラーに読み替え。                                                                   | 高     |
| **FR-15** | **設定の外部化**       | 評価基準プロンプト、スコアリング設定がバックエンドの `config.py` に分離されていること。                                                   | 高     |
| **FR-16** | **CSV文字化け注釈**    | フロントエンドのエクスポートUIに、ExcelでのCSVファイルの開き方に関する注釈を表示する。                                                   | 中     |

### 2.2. 非機能要件 (ほぼ変更なし)
...
### 2.3. インターフェース要件 (更新)
*   ユーザーインターフェース: ... 評価結果エリアに**最新詳細表示と履歴リスト**を追加。エクスポートUIに**注釈**を追加。
*   APIインターフェース: ... `/evaluate` のレスポンス構造を変更 (`gemini_evaluation`, `calculated_scores`)。`/export` のリクエストボディに `resultsList` (配列) を含む。
*   外部インターフェース: (変更なし)
### 2.4. データ/ファイル形式要件 (更新)
*   入力データ: (変更なし)
*   ...
*   バックエンドからフロントエンドへの出力: ... `gemini_evaluation`, `calculated_scores` を含むJSONオブジェクト。
*   出力ファイル (CSV): **日本語ヘッダー** (候補者名, 総合コメント, ...) を使用。**UTF-8 (BOM付き)** エンコーディング。
*   出力ファイル (Markdown): (変更なし - 各結果を見出し、テーブル、引用で整形)
### 2.5. 制約条件 (ほぼ変更なし)
... プロンプト/スコア設定は `config.py` で管理。

## 3. その他 (変更なし)